{"version":3,"sources":["element_binder_builder.js"],"names":[],"mappings":"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","file":"src/core/compiler/pipeline/element_binder_builder.js","sourceRoot":"/Users/justin/workspace/angular2_quckstart/quickstart/node_modules/angular2/es6/prod/","sourcesContent":["import {int,\n  isPresent,\n  isBlank} from 'angular2/src/facade/lang';\nimport {ListWrapper,\n  List,\n  MapWrapper,\n  StringMapWrapper} from 'angular2/src/facade/collection';\nimport {reflector} from 'angular2/src/reflection/reflection';\nimport {Parser,\n  ProtoChangeDetector} from 'angular2/change_detection';\nimport {DirectiveMetadata} from '../directive_metadata';\nimport {CompileStep} from './compile_step';\nimport {CompileElement} from './compile_element';\nimport {CompileControl} from './compile_control';\nimport {dashCaseToCamelCase} from '../string_utils';\nimport {setterFactory} from '../property_setter_factory';\nexport class ElementBinderBuilder extends CompileStep {\n  constructor(parser) {\n    super();\n    this._parser = parser;\n  }\n  process(parent, current, control) {\n    var elementBinder = null;\n    var parentElementBinder = null;\n    var distanceToParentBinder = this._getDistanceToParentBinder(parent, current);\n    if (isPresent(parent)) {\n      parentElementBinder = parent.inheritedElementBinder;\n    }\n    if (current.hasBindings) {\n      var protoView = current.inheritedProtoView;\n      var protoInjectorWasBuilt = isBlank(parent) ? true : current.inheritedProtoElementInjector !== parent.inheritedProtoElementInjector;\n      var currentProtoElementInjector = protoInjectorWasBuilt ? current.inheritedProtoElementInjector : null;\n      elementBinder = protoView.bindElement(parentElementBinder, distanceToParentBinder, currentProtoElementInjector, current.componentDirective, current.viewportDirective);\n      current.distanceToParentBinder = 0;\n      if (isPresent(current.textNodeBindings)) {\n        this._bindTextNodes(protoView, current);\n      }\n      if (isPresent(current.propertyBindings)) {\n        this._bindElementProperties(protoView, current);\n      }\n      if (isPresent(current.eventBindings)) {\n        this._bindEvents(protoView, current);\n      }\n      if (isPresent(current.contentTagSelector)) {\n        elementBinder.contentTagSelector = current.contentTagSelector;\n      }\n      var directives = current.getAllDirectives();\n      this._bindDirectiveProperties(directives, current);\n      this._bindDirectiveEvents(directives, current);\n    } else if (isPresent(parent)) {\n      elementBinder = parentElementBinder;\n      current.distanceToParentBinder = distanceToParentBinder;\n    }\n    current.inheritedElementBinder = elementBinder;\n  }\n  _getDistanceToParentBinder(parent, current) {\n    return isPresent(parent) ? parent.distanceToParentBinder + 1 : 0;\n  }\n  _bindTextNodes(protoView, compileElement) {\n    MapWrapper.forEach(compileElement.textNodeBindings, (expression, indexInParent) => {\n      protoView.bindTextNode(indexInParent, expression);\n    });\n  }\n  _bindElementProperties(protoView, compileElement) {\n    MapWrapper.forEach(compileElement.propertyBindings, (expression, property) => {\n      var setterFn = setterFactory(property);\n      protoView.bindElementProperty(expression.ast, property, setterFn);\n    });\n  }\n  _bindEvents(protoView, compileElement) {\n    MapWrapper.forEach(compileElement.eventBindings, (expression, eventName) => {\n      protoView.bindEvent(eventName, expression);\n    });\n  }\n  _bindDirectiveEvents(directives, compileElement) {\n    for (var directiveIndex = 0; directiveIndex < directives.length; directiveIndex++) {\n      var directive = directives[directiveIndex];\n      var annotation = directive.annotation;\n      if (isBlank(annotation.events))\n        continue;\n      var protoView = compileElement.inheritedProtoView;\n      StringMapWrapper.forEach(annotation.events, (action, eventName) => {\n        var expression = this._parser.parseAction(action, compileElement.elementDescription);\n        protoView.bindEvent(eventName, expression, directiveIndex);\n      });\n    }\n  }\n  _bindDirectiveProperties(directives, compileElement) {\n    var protoView = compileElement.inheritedProtoView;\n    for (var directiveIndex = 0; directiveIndex < directives.length; directiveIndex++) {\n      var directive = ListWrapper.get(directives, directiveIndex);\n      var annotation = directive.annotation;\n      if (isBlank(annotation.bind))\n        continue;\n      StringMapWrapper.forEach(annotation.bind, (bindConfig, dirProp) => {\n        var pipes = this._splitBindConfig(bindConfig);\n        var elProp = ListWrapper.removeAt(pipes, 0);\n        var bindingAst = isPresent(compileElement.propertyBindings) ? MapWrapper.get(compileElement.propertyBindings, dashCaseToCamelCase(elProp)) : null;\n        if (isBlank(bindingAst)) {\n          var attributeValue = MapWrapper.get(compileElement.attrs(), elProp);\n          if (isPresent(attributeValue)) {\n            bindingAst = this._parser.wrapLiteralPrimitive(attributeValue, compileElement.elementDescription);\n          }\n        }\n        if (isPresent(bindingAst)) {\n          var fullExpAstWithBindPipes = this._parser.addPipes(bindingAst, pipes);\n          protoView.bindDirectiveProperty(directiveIndex, fullExpAstWithBindPipes, dirProp, reflector.setter(dashCaseToCamelCase(dirProp)));\n        }\n      });\n    }\n  }\n  _splitBindConfig(bindConfig) {\n    return ListWrapper.map(bindConfig.split('|'), (s) => s.trim());\n  }\n}\nObject.defineProperty(ElementBinderBuilder, \"parameters\", {get: function() {\n    return [[Parser]];\n  }});\nObject.defineProperty(ElementBinderBuilder.prototype.process, \"parameters\", {get: function() {\n    return [[CompileElement], [CompileElement], [CompileControl]];\n  }});\nObject.defineProperty(ElementBinderBuilder.prototype._bindDirectiveEvents, \"parameters\", {get: function() {\n    return [[assert.genericType(List, DirectiveMetadata)], [CompileElement]];\n  }});\nObject.defineProperty(ElementBinderBuilder.prototype._bindDirectiveProperties, \"parameters\", {get: function() {\n    return [[assert.genericType(List, DirectiveMetadata)], [CompileElement]];\n  }});\nObject.defineProperty(ElementBinderBuilder.prototype._splitBindConfig, \"parameters\", {get: function() {\n    return [[assert.type.string]];\n  }});\n//# sourceMappingURL=element_binder_builder.js.map\n\n//# sourceMappingURL=./element_binder_builder.map"]}